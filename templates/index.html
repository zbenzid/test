<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Planning App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .high-priority { background-color: #ffcccc; }
        .medium-priority { background-color: #ffffcc; }
        .low-priority { background-color: #ccffcc; }
        .near-due-date { font-weight: bold; color: #ff0000; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">ğŸ“‹ Team Planning App</h1>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <h2>â• Add New Task</h2>
                <form id="add-task-form">
                    <div class="mb-3">
                        <input type="text" class="form-control" name="title" placeholder="Task Title ğŸ“" required>
                    </div>
                    <div class="mb-3">
                        <textarea class="form-control" name="description" placeholder="Task Description ğŸ“„" required></textarea>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="assigned_to" placeholder="Assigned To ğŸ‘¤" required>
                    </div>
                    <div class="mb-3">
                        <label for="due_date">Due Date ğŸ“…</label>
                        <input type="date" class="form-control" name="due_date" id="due_date" required>
                    </div>
                    <div class="mb-3">
                        <label for="priority">Priority âš ï¸</label>
                        <select class="form-control" name="priority" id="priority" required>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="categories" placeholder="Categories (comma-separated) ğŸ·ï¸">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Task â•</button>
                </form>
            </div>
            <div class="col-md-6">
                <h2>ğŸ” Filter Tasks</h2>
                <form id="filter-form">
                    <div class="mb-3">
                        <label for="sort_by">Sort By ğŸ”¢</label>
                        <select class="form-control" name="sort_by" id="sort_by">
                            <option value="due_date">Sort by Due Date</option>
                            <option value="priority">Sort by Priority</option>
                            <option value="status">Sort by Status</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="filter_status">Filter by Status ğŸš¦</label>
                        <select class="form-control" name="filter_status" id="filter_status">
                            <option value="">All Statuses</option>
                            <option value="Pending">Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="filter_priority">Filter by Priority âš ï¸</label>
                        <select class="form-control" name="filter_priority" id="filter_priority">
                            <option value="">All Priorities</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="filter_category" placeholder="Filter by Category ğŸ·ï¸">
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="search" placeholder="Search tasks ğŸ”">
                    </div>
                    <button type="submit" class="btn btn-secondary">Apply Filters ğŸ”</button>
                </form>
            </div>
        </div>

        <h2>ğŸ“‹ Task List</h2>
        <div id="task-list"></div>
    </div>

    <div class="container mt-3">
        <h3>ğŸ“Œ Instructions</h3>
        <ul>
            <li>Add a new task using the form on the left.</li>
            <li>Use the filter options on the right to sort and filter tasks.</li>
            <li>Click the "Update" button to change a task's status, priority, or due date.</li>
            <li>Tasks with due dates within 3 days will be highlighted in red.</li>
        </ul>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadTasks(filters = {}) {
            $.get('/tasks', filters, function(tasks) {
                let taskHtml = '<table class="table table-striped"><thead><tr><th>Title</th><th>Description</th><th>Assigned To</th><th>Due Date</th><th>Status</th><th>Priority</th><th>Categories</th><th>Action</th></tr></thead><tbody>';
                tasks.forEach(function(task) {
                    const dueDate = new Date(task.due_date);
                    const today = new Date();
                    const diffTime = dueDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const nearDueDate = diffDays <= 3 ? 'near-due-date' : '';
                    const statusEmoji = task.status === 'Pending' ? 'â³' : (task.status === 'In Progress' ? 'ğŸ—ï¸' : 'âœ…');
                    const priorityEmoji = task.priority === 'High' ? 'ğŸ”´' : (task.priority === 'Medium' ? 'ğŸŸ¡' : 'ğŸŸ¢');
                    taskHtml += `
                        <tr class="${task.priority.toLowerCase()}-priority">
                            <td>ğŸ“ ${task.title}</td>
                            <td>ğŸ“„ ${task.description}</td>
                            <td>ğŸ‘¤ ${task.assigned_to}</td>
                            <td class="${nearDueDate}">ğŸ“… ${task.due_date}</td>
                            <td>${statusEmoji} ${task.status}</td>
                            <td>${priorityEmoji} ${task.priority}</td>
                            <td>ğŸ·ï¸ ${task.categories.join(', ')}</td>
                            <td>
                                <form class="update-task-form" data-task-id="${task.id}">
                                    <select name="status" class="form-control mb-2">
                                        <option value="Pending" ${task.status === 'Pending' ? 'selected' : ''}>â³ Pending</option>
                                        <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>ğŸ—ï¸ In Progress</option>
                                        <option value="Completed" ${task.status === 'Completed' ? 'selected' : ''}>âœ… Completed</option>
                                    </select>
                                    <select name="priority" class="form-control mb-2">
                                        <option value="High" ${task.priority === 'High' ? 'selected' : ''}>ğŸ”´ High</option>
                                        <option value="Medium" ${task.priority === 'Medium' ? 'selected' : ''}>ğŸŸ¡ Medium</option>
                                        <option value="Low" ${task.priority === 'Low' ? 'selected' : ''}>ğŸŸ¢ Low</option>
                                    </select>
                                    <input type="date" name="due_date" value="${task.due_date}" class="form-control mb-2">
                                    <button type="submit" class="btn btn-sm btn-primary">Update ğŸ”„</button>
                                </form>
                            </td>
                        </tr>
                    `;
                });
                taskHtml += '</tbody></table>';
                $('#task-list').html(taskHtml);
            });
        }

        $(document).ready(function() {
            loadTasks();

            $('#add-task-form').submit(function(e) {
                e.preventDefault();
                $.post('/add_task', $(this).serialize(), function() {
                    loadTasks();
                    $('#add-task-form')[0].reset();
                });
            });

            $('#filter-form').submit(function(e) {
                e.preventDefault();
                loadTasks($(this).serialize());
            });

            $(document).on('submit', '.update-task-form', function(e) {
                e.preventDefault();
                const taskId = $(this).data('task-id');
                $.post(`/update_task/${taskId}`, $(this).serialize(), function() {
                    loadTasks();
                });
            });
        });
    </script>
</body>
</html>
